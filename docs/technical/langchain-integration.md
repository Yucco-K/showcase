# LangChain 統合技術ドキュメント

## 概要

Portfolio Showcase チャットボットへの LangChain 統合による RAG（Retrieval-Augmented Generation）機能の実装計画。

## 現在のシステム

### 完全制御チャットボット

- **モデル**: GPT-4.1-mini
- **環境**: Deno (Supabase Edge Functions)
- **特徴**: 強制的 Portfolio 商品推奨システム

### 既存機能

- 強制応答ラッパー
- 最終安全チェック
- 外部商品排除システム

## 実装タスクリスト

### ✅ 完了済みタスク

1. **商品データの準備**

   - ✅ Supabase products テーブルからデータ取得
   - ✅ `docs/products/products_database.md`として整理
   - ✅ 30 件の商品データを構造化

2. **ベクトルデータベース構築**

   - ✅ Supabase pgvector テーブル設計
   - ✅ `product_embeddings`テーブル作成マイグレーション
   - ✅ 類似商品検索関数`match_products`実装
   - ✅ RLS ポリシー設定

3. **埋め込み生成システム**

   - ✅ 商品データ埋め込み生成スクリプト作成
   - ✅ OpenAI Embeddings API 統合
   - ✅ 商品検索機能テストスクリプト作成

4. **商品・FAQ データのベクトル化**

   - ✅ 商品データの埋め込み生成実行
   - ✅ 全 30 件の商品データをベクトル化
   - ✅ ベクトル検索の精度テスト
   - ✅ 類似度閾値 0.2 で検索成功
   - ✅ 検索精度の検証完了

5. **クエリ拡張戦略の実装**

   - ✅ クエリ拡張ユーティリティの開発
   - ✅ GPT-3.5-turbo を使用した関連クエリ生成
   - ✅ 拡張クエリによる検索精度の検証

6. **埋め込みモデルの性能比較**

   - ✅ 3 つの埋め込みモデルを比較
   - ✅ コサイン類似度による評価
   - ✅ 商品データの前処理戦略の確立

7. **ドメイン固有の専門用語統合**
   - ✅ カテゴリ別専門用語マッピングの作成
   - ✅ 商品データへの専門用語追加
   - ✅ 埋め込み生成時に専門用語を統合
   - ✅ 検索精度の改善を確認

### 🔄 進行中タスク

8. **LangChain Retriever/QA チェーンの PoC 実装**
   - 🔄 LangChain.js の Deno 環境での動作確認
   - 🔄 埋め込み生成システム構築
   - 🔄 ベクトル検索機能実装
   - 🔄 商品情報検索の精度テスト

### 📋 未着手タスク

9. **チャットボット API への LangChain 統合**

   - 📋 既存チャットボットとの統合
   - 📋 完全制御システムとの連携
   - 📋 応答品質の検証

10. **テスト・品質検証・本番反映**
    - 📋 統合テストの実行
    - 📋 パフォーマンス最適化
    - 📋 本番環境への反映

## ドメイン固有の専門用語統合結果

### カテゴリ別専門用語マッピング

| カテゴリ      | 専門用語                                                                                           |
| ------------- | -------------------------------------------------------------------------------------------------- |
| productivity  | タスク管理、プロジェクト効率化、ワークフロー最適化、生産性向上、時間管理、TODO 管理、リソース配分  |
| health        | ウェルネス、フィットネス追跡、健康データ可視化、セルフケア、運動記録、栄養管理、メンタルヘルス     |
| business      | 在庫管理、財務分析、経営指標、ビジネスインテリジェンス、コスト最適化、リソース管理、生産性分析     |
| entertainment | コンテンツキュレーション、パーソナライズ推奨、メディア管理、エンターテインメント分析、トレンド追跡 |

### 検索結果の詳細

#### タスク管理アプリ検索

- **トップ結果**: CollabPlanner (類似度: 87.3%)
- **関連アプリ**: Simple TODO (87.2%), EliteEdge Labs (85.5%)
- **専門用語の影響**: タスク管理、プロジェクト効率化、生産性向上などのキーワードが検索精度を向上

#### 健康管理アプリ検索

- **トップ結果**: Lift Atlas (類似度: 86.6%)
- **関連アプリ**: Health Tracker (85.7%), TapTrack (85.5%)
- **専門用語の影響**: ウェルネス、フィットネス追跡、健康データ可視化などのキーワードが検索の質を改善

#### レシピ管理アプリ検索

- **トップ結果**: MyRecipeNote (類似度: 86.0%)
- **関連アプリ**: Inventory Lite (84.9%), AppBuzz Hive (83.7%)
- **専門用語の影響**: カテゴリ固有の専門用語が検索結果の多様性を向上

#### アイデア整理ツール検索

- **トップ結果**: Simple TODO (類似度: 87.9%)
- **関連アプリ**: EliteEdge Labs (86.6%), IdeaLog (86.4%)
- **専門用語の影響**: タスク管理、プロジェクト効率化などの生産性関連キーワードが検索精度に貢献

#### 音楽プレイリスト検索

- **トップ結果**: AppJive Junction (類似度: 83.8%)
- **関連アプリ**: Simple TODO (79.0%), Mind Craft (78.4%)
- **専門用語の影響**: エンターテインメント分析、コンテンツキュレーションなどのキーワードが検索に寄与

## 技術的課題と対応

### 現在の課題

- 埋め込みモデル間で大きな性能差が見られない
- クエリと商品データの埋め込みマッチングの最適化が必要
- 拡張クエリを使用しても検索結果の大幅な改善が限定的

### クエリ拡張戦略の詳細

1. **拡張手法**

   - GPT-3.5-turbo を使用した関連クエリ生成
   - 元のクエリに対する同義語、類似表現の生成
   - 複数の観点からのクエリ拡張

2. **実装アプローチ**
   - クエリごとに 3-6 の関連クエリを生成
   - 各拡張クエリを並列でベクトル化
   - 複数の埋め込みを使用して検索
   - 結果の重複排除と類似度によるランキング

### 次のステップ

1. 埋め込みモデルの調整

   - text-embedding-3-small の性能評価
   - より高性能な埋め込みモデルの検討
   - カスタムファインチューニングの可能性

2. クエリ拡張戦略の改良

   - 拡張クエリの質的改善
   - ドメイン固有の専門用語の追加
   - 学習データの拡充

3. 類似度閾値の動的調整
   - 検索結果の質に基づく閾値の自動調整
   - マシンラーニングによる最適化

## 期待される効果

- より精度の高い商品推奨
- ユーザーニーズに合わせた柔軟な検索
- RAG 技術による回答品質の向上

## 注意事項

- 既存の完全制御システムを維持
- 段階的な統合でリスク最小化
- コスト効率の考慮
